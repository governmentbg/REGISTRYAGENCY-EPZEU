import { ObjectHelper } from 'Cnsys.Core';
import { IndentTypes, RecordValidator, SimpleAddressValidator, SubjectBaseValidator } from 'EPZEU.CR.Domain';
import { F321_DistraintData } from '../ModelsAutoGenerated';

export class F321_DistraintDataValidator extends RecordValidator<F321_DistraintData> {
    constructor() {
        super();

        this.ruleFor(m => m.subject).setValidator(new SubjectBaseValidator());
    }

    public validateInternal(obj: F321_DistraintData): boolean {

        let isValid = super.validateInternal(obj);

        obj.address.clearErrors();

        if (!this.validationContext.isRecordEmpty(obj)) {
            if (ObjectHelper.isStringNullOrEmpty(obj.subject.name) && ObjectHelper.isStringNullOrEmpty(obj.subject.indent)) {
                obj.addError(this.getMessage('GL_INPUT_NAME_ID_E'));
                isValid = false;
            }

            if (isValid
                && (obj.subject.indentType == IndentTypes.EGN
                    || obj.subject.indentType == IndentTypes.LNCH
                    || obj.subject.indentType == IndentTypes.BirthDate)) {

                let isValidAddress = new SimpleAddressValidator();
                isValidAddress.setValidationContext(this.getValidationContext());

                if (!isValidAddress.validate(obj.address))
                    isValid = false;
            }
        }

        return isValid;
    }
}