import { ObjectHelper } from 'Cnsys.Core';
import { IndentTypes, PersonBaseValidator, RecordValidator, SimpleAddressValidator } from 'EPZEU.CR.Domain';
import { F317_Depositor } from '../ModelsAutoGenerated';

export class F317_DepositorValidator extends RecordValidator<F317_Depositor> {

    constructor() {
        super();

        this.ruleFor(m => m.person).setValidator(new PersonBaseValidator());
    }

    public validateInternal(obj: F317_Depositor): boolean {

        let isValid = super.validateInternal(obj);

        obj.address.clearErrors();
        if (!this.validationContext.isRecordEmpty(obj)) {
            if (ObjectHelper.isStringNullOrEmpty(obj.person.name) && ObjectHelper.isStringNullOrEmpty(obj.person.indent)) {
                obj.addError(this.getMessage('GL_INPUT_NAME_ID_E'));
                isValid = false;
            }

            if (isValid && (obj.person.indentType == IndentTypes.EGN || obj.person.indentType == IndentTypes.LNCH || obj.person.indentType == IndentTypes.BirthDate)) {

                let isValidAddress = new SimpleAddressValidator();
                isValidAddress.setValidationContext(this.getValidationContext());

                if (!isValidAddress.validate(obj.address))
                    isValid = false;
            }
        }

        return isValid;
    }
}
