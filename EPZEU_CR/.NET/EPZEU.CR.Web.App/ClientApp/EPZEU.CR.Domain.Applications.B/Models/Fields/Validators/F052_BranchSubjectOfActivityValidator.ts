import { ObjectHelper } from 'Cnsys.Core';
import { ApplicationFormTypes, LegalForms } from 'EPZEU.CR.Core';
import { RecordValidator } from 'EPZEU.CR.Domain';
import { F052_BranchSubjectOfActivity } from '../ModelsAutoGenerated';

export class F052_BranchSubjectOfActivityValidator extends RecordValidator<F052_BranchSubjectOfActivity> {

    public validateInternal(obj: F052_BranchSubjectOfActivity): boolean {
        let isValid = super.validateInternal(obj);

        if (!isValid) return false;

        let mainAppType = (this.validationContext.applicationManager.processContext as any).mainApplicationProcess.mainApplicationType;
        let legalForm = <LegalForms>(this.validationContext.applicationManager.additionalData.legalForm);

        let isAssoc: boolean;
        let isFound: boolean;
        let isCC: boolean;

        // Ако в пакета има А15(Сдружение), без значение дали е за нова регистрация или за пререгистрация
        if (mainAppType == ApplicationFormTypes.A15 || legalForm == LegalForms.ASSOC)
            isAssoc = true;

        // Ако в пакета има А16(Фондация), без значение дали е за нова регистрация или за пререгистрация
        else if (mainAppType == ApplicationFormTypes.A16 || legalForm == LegalForms.FOUND)
            isFound = true;

        // Ако в пакета има А17(читалище), без значение дали е за нова регистрация или за пререгистрация
        else if (mainAppType == ApplicationFormTypes.A17 || legalForm == LegalForms.CC)
            isCC = true;

        if (!isAssoc && !isFound && !isCC) {
            if (ObjectHelper.isStringNullOrEmpty(obj.text)) {
                obj.addError('text', this.getMessage('CR_APP_00015_Е'))
                isValid = false;
            }
        }

        return isValid;
    }
}