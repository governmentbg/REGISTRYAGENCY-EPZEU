import { EPZEUBaseValidator } from 'EPZEU.Core';
import { IApplicationFormValidationContext, RecordOperations, RecordValidator, SubjectFLEWithCountyValidator, ValidatorHelpers } from 'EPZEU.CR.Domain';
import { F01230_AdministrativeBoardSupporter, F012v_AdministrativeBoardSupporters } from '../ModelsAutoGenerated';

class F01230_AdministrativeBoardSupporterValidator extends RecordValidator<F01230_AdministrativeBoardSupporter> {

    constructor() {
        super();

        this.ruleFor(m => m.subject).setValidator(new SubjectFLEWithCountyValidator());
    }

    public validateInternal(obj: F01230_AdministrativeBoardSupporter): boolean {        

        let isValid = super.validateInternal(obj);
            
        return isValid;
    }
}

export class F012v_AdministrativeBoardSupportersValidator extends EPZEUBaseValidator<F012v_AdministrativeBoardSupporters, IApplicationFormValidationContext> {
    constructor() {
        super();

        this.ruleFor(m => m.administrativeBoardSupporterList).setCollectionValidator(new F01230_AdministrativeBoardSupporterValidator());
    }

    public validate(obj: F012v_AdministrativeBoardSupporters): boolean {
        let isValid = super.validate(obj);

        if (obj.administrativeBoardSupporterList.length > 1) {
            for (var i = 0; i < obj.administrativeBoardSupporterList.length; i++) {

                if (ValidatorHelpers.isObjectWithPersonEmpty(obj.administrativeBoardSupporterList[i], "subject")  && obj.administrativeBoardSupporterList[i].recordOperation != RecordOperations.Erase) {
                    obj.administrativeBoardSupporterList[i].clearErrors(true);
                    obj.administrativeBoardSupporterList[i].addError(this.getMessage('CR_APP_00063_E'));

                    isValid = false;
                }
            }

            //Грешката се визуалзира при добавяне на второ и следващо лице със същия идентификатор като на вече добавено лице
            if (ValidatorHelpers.isExistDublicateIndents(obj.administrativeBoardSupporterList, false, "CR_APP_00128_E")) // 
                isValid = false; 
           
        }

        return isValid;
    }
}