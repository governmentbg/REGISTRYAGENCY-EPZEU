import { EPZEUBaseValidator } from 'EPZEU.Core';
import { IApplicationFormValidationContext, PersonWithCountyValidator, RecordOperations, RecordValidator, ValidatorHelpers } from 'EPZEU.CR.Domain';
import { F01510_ControllingBoardSupportersPerson, F015a_ControllingBoardSupporters } from '../ModelsAutoGenerated';

export class F01510_ControllingBoardSupportersPersonValidator extends RecordValidator<F01510_ControllingBoardSupportersPerson> {

    constructor() {
        super();

        this.ruleFor(m => m.person).setValidator(new PersonWithCountyValidator());
    }

    public validateInternal(obj: F01510_ControllingBoardSupportersPerson): boolean {      

        let isValid = super.validateInternal(obj);       

        return isValid;
    }
}

export class F015a_ControllingBoardSupportersValidator extends EPZEUBaseValidator<F015a_ControllingBoardSupporters, IApplicationFormValidationContext> {
    constructor() {
        super();

        this.ruleFor(m => m.controllingBoardSupportersPersonList).setCollectionValidator(new F01510_ControllingBoardSupportersPersonValidator());
    }

    public validate(obj: F015a_ControllingBoardSupporters): boolean {
        let isValid = super.validate(obj);

        if (obj.controllingBoardSupportersPersonList.length > 1) {
            for (var i = 0; i < obj.controllingBoardSupportersPersonList.length; i++) {

                if (ValidatorHelpers.isObjectWithPersonEmpty(obj.controllingBoardSupportersPersonList[i], "person") && obj.controllingBoardSupportersPersonList[i].recordOperation != RecordOperations.Erase) {
                    obj.controllingBoardSupportersPersonList[i].clearErrors(true);
                    obj.controllingBoardSupportersPersonList[i].addError(this.getMessage('CR_APP_00063_E')); //Попълнете данните за полето или го изтрийте.

                    isValid = false;
                }
            }

            //При добавяне на второ и следващо лице трябва да се извършва проверкта дали идентификатора на добавеното лице със същия идентификатор като на вече добавено лице. 
            //Валидацията не се прилага за идентификатор Дата на раждане 
            if (obj.controllingBoardSupportersPersonList.length > 1) {

                if (ValidatorHelpers.isExistDublicateIndents(obj.controllingBoardSupportersPersonList, true, "CR_APP_00120_E"))
                    isValid = false;
            }
        }      

        return isValid;
    }
}