import { ObjectHelper } from 'Cnsys.Core';
import { RecordValidator } from 'EPZEU.CR.Domain';
import { F8040_ReorgBranch } from '../ModelsAutoGenerated';
import { BranchValidator } from './BranchValidator';
import { CompanyValidator } from './CompanyValidator';

export class F8040_ReorgBranchesValidator extends RecordValidator<F8040_ReorgBranch> {
    constructor() {
        super();

        this.ruleFor(m => m.branches).setCollectionValidator(new BranchValidator());
        this.ruleFor(m => m.branchSubject).setValidator(new CompanyValidator());
    }

    public validateInternal(obj: F8040_ReorgBranch): boolean {
        let isValid = super.validateInternal(obj);

        for (var j = obj.branches.length - 1; j >= 0; j--) {

            if (ObjectHelper.isStringNullOrEmpty(obj.branches[j].branchCode) && ObjectHelper.isStringNullOrEmpty(obj.branches[j].firmName) && obj.branches.length > 1) {
                obj.branches[j].addError(this.getMessage("CR_APP_00063_E")); // Попълнете данните за полето или го изтрийте.
                isValid = false;
            }
        }  

        return isValid;
    }
}