import { ArrayHelper, ObjectHelper } from 'Cnsys.Core';
import { ApplicationFormFieldsBaseValidator } from 'EPZEU.CR.Domain';
import { F801_FormOfTransformingValidator } from '../../Fields/Validators/F801_FormOfTransformingValidator';
import { F802_ReorganizeCoOperativesValidator } from '../../Fields/Validators/F802_ReorganizeCoOperativesValidator';
import { F803_SuccessorsValidator } from '../../Fields/Validators/F803_SuccessorsValidator';
import { V31Fields } from '../ModelsAutoGenerated';

export class V31FieldsValidator extends ApplicationFormFieldsBaseValidator<V31Fields>{
    constructor() {
        super();
        this.ruleFor(m => m.formOfTransforming801).setValidator(new F801_FormOfTransformingValidator());
        this.ruleFor(m => m.reorganizeCoOperatives).setValidator(new F802_ReorganizeCoOperativesValidator());
        this.ruleFor(m => m.successors803).setValidator(new F803_SuccessorsValidator());
    }

    public validate(obj: V31Fields): boolean {
        let isValid = super.validate(obj);

        let hasAtLeastOneReorganizeCoOperative = ArrayHelper.queryable.from(obj.reorganizeCoOperatives.coOperativeList).where(m => !this.validationContext.isRecordEmpty(m)).count() > 0;
        if (hasAtLeastOneReorganizeCoOperative == false) {
            obj.reorganizeCoOperatives.clearErrors();
            obj.reorganizeCoOperatives.addError(this.getMessage('CR_APP_00035_E')); // Задължително е попълването поне на еднa кооперация.
            isValid = false;
        }

        for (var i = 0; i < obj.reorganizeCoOperatives.coOperativeList.length; i++) {
            let cooperative = obj.reorganizeCoOperatives.coOperativeList[i];
            if (this.validationContext.isRecordEmpty(cooperative) && obj.reorganizeCoOperatives.coOperativeList.length > 1) {
                cooperative.clearErrors();
                cooperative.addError(this.getMessage('CR_APP_00063_E')); //Попълнете данните за полето или го изтрийте.
                isValid = false;
            }
        }

        return isValid;
    }
}