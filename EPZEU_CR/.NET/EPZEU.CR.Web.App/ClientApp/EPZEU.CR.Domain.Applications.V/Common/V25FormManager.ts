import { IApplicationWithFieldsFormManager, RecordOperations } from 'EPZEU.CR.Domain';
import { V25 } from '../Models/ApplicationForms/ApplicationFormsV';
import { ApplicationFormVBaseManager } from './ApplicationFormVBaseManager';
import { F7030_Successor } from '../Models/Fields/ModelsAutoGenerated';
import { ObjectHelper } from 'Cnsys.Core';

export interface IV25FormManager extends IApplicationWithFieldsFormManager {
}

export function Is25FormManager(obj: IV25FormManager | any): obj is IV25FormManager {
    return obj && (ObjectHelper.isSubClassOf(obj, V25FormManager));
}

export class V25FormManager extends ApplicationFormVBaseManager<V25> implements IV25FormManager {

    protected createApplication(obj: any): V25 {
        return new V25(obj);
    }

    /**Инициализира данните на заявленеито*/
    protected initApplicationData(): Promise<void> {
        return super.initApplicationData().bind(this).then(() => {
            // Поле 703 понякога се държи като списъчно, понякога не (в зависимост от това какво е избрано в 701)
            // Може да е задължително или не (пак в зависимост от 701)
            // Затова не можем да го инициализираме в V21Provider.cs - ако го инициалицираме там и после 
            // в 701 е избрана такава опция, че 703 да не е задължително за попълване, и го оставим празно,
            // то няма да се прати към търговския (защото се прави сравнение - вижда се, че няма промяна, и не го праща),
            // а в старата система се праща (макар и празно)
            if (this.application.fields.successors703.successorList.length == 0) {
                let successor = new F7030_Successor();
                successor.legalForm = '-1';
                successor.recordOperation = RecordOperations.Add;
                successor.recordID = ObjectHelper.newGuid();
                this.application.fields.successors703.successorList.push(successor)
            }
        });
    }
}